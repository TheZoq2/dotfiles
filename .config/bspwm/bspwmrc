#!/bin/bash

export MOZ_USE_XINPUT2=1

if [ $1 = "tablet" ]; then
    echo 'export IS_TABLET=1' > /tmp/wm_settings

    echo 'export RIGHT_PADDING=3' >> /tmp/wm_settings
    echo 'export BOTTOM_PADDING=45' >> /tmp/wm_settings
    echo 'export REST_PADDING=3' >> /tmp/wm_settings
else 
    echo 'export IS_TABLET=0' > /tmp/wm_settings

    echo 'export RIGHT_PADDING=27' >> /tmp/wm_settings
    echo 'export BOTTOM_PADDING=3' >> /tmp/wm_settings
    echo 'export REST_PADDING=3' >> /tmp/wm_settings
fi

source /tmp/wm_settings

OLD_PATH=$PATH
PATH=$PATH:$HOME/bin/:$HOME/.cargo/bin

#Restart all our programs
pkill sxhkd
pkill tint2
pkill xfce4-panel
pkill xfce4-power-manager
pkill volumeicon
pkill nm-applet
# pkill compton;
pkill redshift
pkill wpmServer.py
pkill blueman-applet
pkill rspwm
pkill touchegg
#wp k #Kill the wallpaper manager

CONFIG_DIR="/home/frans/.config/bspwm"

#Starting required stuff
# compton --config ~/.config/compton/comptonrc & #Transparent windows
#feh --bg-fill --no-xinerama /home/frans/Pictures/wallpapers/current.png #set background
#feh --bg-fill /home/frans/Pictures/wallpapers/current.png #set background
./wallpaper

echo "Bottom padding ${BOTTOM_PADDING}, right padding: ${RIGHT_PADDING}"

bspc config border_width        1
bspc config window_gap         4

~/.config/bspwm/configure_padding

bspc config split_ratio         0.50
bspc config borderless_monocle  true
bspc config gapless_monocle     true
bspc config focus_by_distance   true
bspc config focus_follows_pointer true
bspc config pointer_follows_monitor true
bspc config auto_cancel true
bspc config normal_border_color "#000000"

#change working directory to allow relative paths in python and bash
cd $CONFIG_DIR
./startup.py #Setup everything python based
#./pypanel.py #Create the panel


#Monitor layout is handled by python script
#bspc monitor -d I II III IV V VI VII VIII IX X

if [ $IS_TABLET -eq 1 ]; then
    xfce4-panel --disable-wm-check &
else
    tint2 &
fi

xfce4-power-manager &
volumeicon &
nm-applet &
redshift &
#python3 /home/frans/bin/wallpaperManager
setxkbmap us -variant altgr-intl -option caps:ctrl_modifier
#Reload xresources
xrdb ~/.XResources & 
wpmServer.py &
blueman-applet & 
/home/frans/.cargo/bin/rspwm &
touchegg &
autostart &

# Move tint2 behind fullscreen windows
xdo above -t "$(xdo id -N Bspwm -n root | sort | head -n 1)" $(xdo id -n tint2)

#Reset the working directory
cd


sxhkd &

#Enable if something goes wrong
#xfce4-terminal &

PATH=$OLD_PATH


